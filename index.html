<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ứng dụng Thiệp Cưới & Mua Sắm</title>
  <style>
    body { font-family: Arial, sans-serif; background: #fff0f5; margin: 0; padding: 0; }
    nav { background: #ff69b4; padding: 10px; display: none; justify-content: space-around; position: sticky; top: 0; z-index: 10; }
    nav a { text-decoration: none; color: #fff; font-weight: bold; }
    .section { display: none; padding: 20px; }
    .active { display: block; }
    .card { background: #fff; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); padding: 20px; margin-bottom: 20px; }
    input, textarea, select { width: 100%; margin-bottom: 10px; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #ff69b4; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    img { max-width: 100px; height: auto; display: block; margin-bottom: 10px; }
    .product { border: 1px solid #ccc; border-radius: 5px; padding: 10px; margin-bottom: 10px; background: #fff; }
    .hidden { display: none; }
  </style>
</head>
<body>

<nav id="navbar">
  <a href="#" onclick="showSection('wedding-card')">Thiệp Cưới</a>
  <a href="#" onclick="showSection('shop')">Mua Quà</a>
  <a href="#" onclick="showSection('rental')">Thuê Đồ</a>
  <a href="#" onclick="showSection('orders')">Đơn Hàng</a>
  <a href="#" onclick="logout()">Đăng Xuất</a>
</nav>

<div class="section active" id="auth">
  <div class="card">
    <h2>Đăng Nhập</h2>
    <input type="text" id="login-username" placeholder="Tên đăng nhập">
    <input type="password" id="login-password" placeholder="Mật khẩu">
    <button onclick="login()">Đăng Nhập</button>
    <p><a href="#" onclick="showRegister()">Chưa có tài khoản? Đăng ký</a></p>
  </div>
  <div class="card hidden" id="register-card">
    <h2>Đăng Ký</h2>
    <input type="text" id="register-username" placeholder="Tên đăng nhập">
    <input type="password" id="register-password" placeholder="Mật khẩu">
    <input type="password" id="register-confirm" placeholder="Nhập lại mật khẩu">
    <button onclick="register()">Đăng Ký</button>
  </div>
</div>

<div class="section" id="wedding-card">
  <div class="card">
    <h2>Tạo Thiệp Cưới</h2>
    <input id="bride" placeholder="Tên cô dâu">
    <input id="groom" placeholder="Tên chú rể">
    <input id="location" placeholder="Địa điểm tổ chức">
    <input id="datetime" placeholder="Ngày giờ">
    <input id="guest" placeholder="Kính mời">
    <select id="font">
      <option value="Arial">Arial</option>
      <option value="Georgia">Georgia</option>
      <option value="Courier New">Courier New</option>
    </select>
    <input type="color" id="color" value="#ff69b4">
    <button onclick="generateCard()">Tạo Thiệp</button>
    <div id="card-preview" style="margin-top:20px;"></div>
  </div>
</div>

<div class="section" id="shop">
  <div class="card">
    <h2>Mua Quà</h2>
    <div id="admin-shop-form" class="hidden">
      <input type="file" id="gift-img" onchange="previewImage(event, 'gift-preview')">
      <img id="gift-preview" class="hidden" />
      <input id="gift-name" placeholder="Tên sản phẩm">
      <input id="gift-price" placeholder="Giá">
      <button onclick="addProduct('shop')">Thêm sản phẩm</button>
    </div>
    <div id="shop-products"></div>
  </div>
</div>

<div class="section" id="rental">
  <div class="card">
    <h2>Thuê Đồ</h2>
    <div id="admin-rental-form" class="hidden">
      <input type="file" id="rental-img" onchange="previewImage(event, 'rental-preview')">
      <img id="rental-preview" class="hidden" />
      <input id="rental-name" placeholder="Tên đồ thuê">
      <input id="rental-price" placeholder="Giá thuê">
      <button onclick="addProduct('rental')">Thêm đồ thuê</button>
    </div>
    <div id="rental-products"></div>
  </div>
</div>

<div class="section" id="orders">
  <div class="card">
    <h2>Đơn Hàng</h2>
    <div id="order-list"></div>
  </div>
</div>

<script>
let currentUser = null;
let users = JSON.parse(localStorage.getItem('users')) || {};
let products = JSON.parse(localStorage.getItem('products')) || { shop: [], rental: [] };
let orders = JSON.parse(localStorage.getItem('orders')) || [];

function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if (id === 'shop') renderProducts('shop');
  if (id === 'rental') renderProducts('rental');
  if (id === 'orders') renderOrders();
}

function showRegister() {
  document.getElementById('register-card').classList.remove('hidden');
}

function login() {
  const user = document.getElementById('login-username').value;
  const pass = document.getElementById('login-password').value;
  if ((user === 'admin' && pass === '123456') || (users[user] && users[user] === pass)) {
    currentUser = user;
    document.getElementById('auth').style.display = 'none';
    document.getElementById('navbar').style.display = 'flex';
    document.getElementById('admin-shop-form').classList.toggle('hidden', user !== 'admin');
    document.getElementById('admin-rental-form').classList.toggle('hidden', user !== 'admin');
    showSection('wedding-card');
  } else {
    alert('Sai tài khoản hoặc mật khẩu');
  }
}

function register() {
  const user = document.getElementById('register-username').value;
  const pass = document.getElementById('register-password').value;
  const confirm = document.getElementById('register-confirm').value;
  if (!user || !pass || pass !== confirm) return alert('Lỗi đăng ký');
  users[user] = pass;
  localStorage.setItem('users', JSON.stringify(users));
  alert('Đăng ký thành công!');
}

function logout() {
  currentUser = null;
  location.reload();
}

function previewImage(event, id) {
  const img = document.getElementById(id);
  const reader = new FileReader();
  reader.onload = () => { img.src = reader.result; img.classList.remove('hidden'); img.dataset.src = reader.result; };
  reader.readAsDataURL(event.target.files[0]);
}

function addProduct(type) {
  const name = document.getElementById(`${type}-name`).value;
  const price = document.getElementById(`${type}-price`).value;
  const img = document.getElementById(`${type}-preview`).dataset.src;
  products[type].push({ name, price, img });
  localStorage.setItem('products', JSON.stringify(products));
  renderProducts(type);
}

function renderProducts(type) {
  const container = document.getElementById(`${type}-products`);
  container.innerHTML = '';
  products[type].forEach((p, i) => {
    const div = document.createElement('div');
    div.className = 'product';
    div.innerHTML = `<img src="${p.img}" /><p><b>${p.name}</b> - ${p.price}đ</p>`;
    if (currentUser === 'admin') {
      div.innerHTML += `<button onclick="deleteProduct('${type}', ${i})">Xóa</button>`;
    } else {
      div.innerHTML += `
        <input placeholder='Tên người nhận' id='name-${type}-${i}' />
        <input placeholder='SĐT' id='phone-${type}-${i}' />
        <input placeholder='Địa chỉ' id='addr-${type}-${i}' />
        <button onclick="placeOrder('${type}', ${i})">Mua</button>`;
    }
    container.appendChild(div);
  });
}

function deleteProduct(type, index) {
  products[type].splice(index, 1);
  localStorage.setItem('products', JSON.stringify(products));
  renderProducts(type);
}

function placeOrder(type, i) {
  const name = document.getElementById(`name-${type}-${i}`).value;
  const phone = document.getElementById(`phone-${type}-${i}`).value;
  const addr = document.getElementById(`addr-${type}-${i}`).value;
  if (!name || !phone || !addr) return alert('Vui lòng nhập đầy đủ thông tin');
  orders.push({ user: currentUser, name, phone, addr, product: products[type][i], type, status: 'Chờ xác nhận' });
  localStorage.setItem('orders', JSON.stringify(orders));
  alert('Đặt hàng thành công');
}

function renderOrders() {
  const container = document.getElementById('order-list');
  container.innerHTML = '';
  orders.forEach((o, i) => {
    if (currentUser === 'admin' || currentUser === o.user) {
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `<p><b>${o.type === 'shop' ? 'Mua' : 'Thuê'}:</b> ${o.product.name} - ${o.product.price}đ</p>
      <p>Khách: ${o.name}, ${o.phone}, ${o.addr}</p>
      <p>Trạng thái: ${o.status}</p>`;
      if (currentUser === 'admin' && o.status === 'Chờ xác nhận') {
        div.innerHTML += `<button onclick="confirmOrder(${i})">Xác nhận</button>`;
      }
      container.appendChild(div);
    }
  });
}

function confirmOrder(i) {
  orders[i].status = 'Đã xác nhận';
  localStorage.setItem('orders', JSON.stringify(orders));
  renderOrders();
}

function generateCard() {
  const bride = document.getElementById('bride').value;
  const groom = document.getElementById('groom').value;
  const loc = document.getElementById('location').value;
  const time = document.getElementById('datetime').value;
  const guest = document.getElementById('guest').value;
  const font = document.getElementById('font').value;
  const color = document.getElementById('color').value;
  const preview = document.getElementById('card-preview');
  preview.innerHTML = `<div style="border:2px solid ${color}; padding:20px; font-family:${font}; color:${color}; text-align:center;">
    <h2>Thiệp Mời</h2>
    <p>Kính mời: <b>${guest}</b></p>
    <p>Tới dự lễ cưới của</p>
    <h3>${bride} & ${groom}</h3>
    <p>Tại: ${loc}</p>
    <p>Vào lúc: ${time}</p>
  </div>`;
}
</script>

</body>
</html>
